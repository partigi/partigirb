= partigirb

Ruby wrapper for the Partigi API, adapted from Grackle by Hayes Davis (http://github.com/hayesdavis/grackle/tree/master).

== What is Partigi?

[Partigi](http://www.partigi.com) is a service that helps you choose your next cultural items, share short reviews and keep track of what you have consumed and own.

The Partigi API is an almost-REST based Atom API where we offer you almost all data and functionality that you have in the website.

There is also a [complete documentation of the API](http://partigi.pbworks.com/).

== Usage

=== Creating a client

==== Without Authentication

  client = Partigirb::Client.new

==== With Authentication

  client = Partigirb::Client.new(:auth => {:login => 'SOMEUSERLOGIN', :api_secret => 'SECRETGENERATEDFORTHEUSER'})
  
==== With specific API version
  
  client = Partigirb::Client.new(:api_version => 2)
  
=== Request methods

A request to Partigi servers is done by translating Partigi URL paths into a set of chained method calls, just changing slashes by dots. Each call is used to build the request URL until a format call is found which causes the request to be sent. In order to specify the HTTP method use:

- <tt>?</tt> for HTTP GET
- <tt>!</tt> for HTTP POST (in this case you will need to use a client with authentication)

A request is not performed until either you add the above signs to your last method call or you use a format method call.

=== Formats

The response format is specified by a method call with the format name (atom, json or xml). Notice that the only format fully implemented on Partigi API at the moment is atom, which is the default used by the wrapper.

=== Example requests

The simplest way of executing a GET request is to use the <tt>?</tt> notation, using the default format.

  client.users.show? :id => 'johnwayne'     # http://www.partigi.com/api/v1/users/show.atom?id=johnwayne
  
Also you can force the format:
  
  client.users.show.json? :id => 'johnwayne # http://www.partigi.com/api/v1/users/show.json?id=johnwayne

For POST requests just change <tt>?</tt> by <tt>!</tt>:
  
  client.reviews.update! :id => 123, :status => 1 # POST to http://www.partigi.com/api/v1/reviews/update.atom
  

=== Parameter handling

- All parameters are URL encoded as necessary.
- If you use a File object as a parameter it will be POSTed to Partigi in a multipart request.
- If you use a Time object as a parameter, .httpdate will be called on it and that value will be used

=== Return values

The returned values are always OpenStruct objects (wrapped in Partigirb::PartigiStruct) containing the response values as attributes. 

If the response contains several entries the client returns an Array of OpenStruct objects.

When using Atom format Partigi returns some XML elements using namespaces. In those cases the elements are mapped to attributes by convention, for example: namespaceName:attribute becomes <tt>namespaceName</tt>_<tt>attribute</tt>

=== Error handling

In case Partigi returns an error response, this is turned into a PartigiError object with message attribute set to the error string returned in the XML response.

== Requirements

- json
- mime-types

== Copyright

Copyright (c) 2009 Alvaro Bautista & Fernando Blat, released under MIT license
